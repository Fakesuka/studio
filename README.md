# YakGo: Ваш надежный помощник на дорогах Якутии

## 1. Описание проекта

YakGo — это фронтенд-прототип многофункциональной платформы для автовладельцев в Якутии. Приложение объединяет в себе несколько ключевых сервисов:

*   **Вызов помощи на дороге:** Позволяет клиентам быстро найти исполнителя для решения проблем (отогрев авто, доставка топлива, техпомощь, эвакуатор).
*   **Маркетплейс:** Площадка, где водители и магазины могут продавать товары первой необходимости для автомобилистов.
*   **Две роли:** Приложение имеет два основных интерфейса: для **клиентов** и для **водителей-исполнителей**.

Этот репозиторий содержит полнофункциональный фронтенд, созданный с помощью Next.js. **Вся бэкенд-логика (база данных, аутентификация, платежи) в данный момент симулируется** на стороне клиента и готова к замене на реальные API-запросы.

## 2. Стек технологий

*   **Фреймворк:** [Next.js](https://nextjs.org/) (App Router)
*   **Язык:** [TypeScript](https://www.typescriptlang.org/)
*   **UI-компоненты:** [Shadcn/UI](https://ui.shadcn.com/)
*   **Стилизация:** [Tailwind CSS](https://tailwindcss.com/)
*   **Карты:** [2GIS API](https://docs.2gis.ru/ru/maps/intro)
*   **AI-функции:** [Genkit (Google AI)](https://firebase.google.com/docs/genkit)
*   **Управление состоянием:** React Context API (симуляция в `localStorage`)

## 3. Как запустить проект

1.  **Установите зависимости:**
    ```bash
    npm install
    ```
2.  **Запустите сервер для разработки:**
    ```bash
    npm run dev
    ```
    Приложение будет доступно по адресу `http://localhost:9002`.

## 4. Структура проекта

*   `src/app/`: Основная директория с маршрутами и страницами приложения.
    *   `src/app/(app)/`: Группа маршрутов для аутентифицированных пользователей (клиентов и водителей).
    *   `src/app/page.tsx`: Приветственная страница для выбора роли.
*   `src/components/`: Все UI-компоненты, включая компоненты `shadcn/ui` и кастомные (например, `header.tsx`, `map-2gis.tsx`).
*   `src/context/AppContext.tsx`: **Ключевой файл!** Здесь находится вся логика управления состоянием приложения. В данный момент он симулирует работу с бэкендом, используя `useState` и `localStorage`. **Это главный файл для интеграции вашего бэкенда.**
*   `src/lib/`: Вспомогательные файлы.
    *   `types.ts`: Определения всех TypeScript-типов, используемых в приложении.
    *   `data.ts`: Mock-данные (товары, магазины), которые используются для инициализации прототипа.
*   `src/ai/`: Логика для работы с генеративным ИИ (Genkit).
    *   `diagnose-problem.ts`: Flow, который анализирует описание проблемы клиента и предлагает тип услуги.

## 5. Текущее состояние и симуляция данных

Фронтенд является полнофункциональным прототипом. Это означает, что все интерфейсы и переходы между ними работают, но данные не сохраняются на сервере.

**Вся информация (заказы, товары, профили) хранится в `localStorage` вашего браузера.** Это позволяет демонстрировать работу приложения без необходимости разворачивать бэкенд. При перезагрузке страницы состояние восстанавливается из `localStorage`.

Основной файл, отвечающий за эту симуляцию, — `src/context/AppContext.tsx`.

## 6. Что осталось сделать: План по разработке бэкенда

Ваша главная задача — заменить симуляцию в `AppContext.tsx` на реальные HTTP-запросы к вашему бэкенд-серверу.

### Шаг 1: Аутентификация

Сейчас в приложении используется "заглушка" пользователя (`MOCK_USER_ID = 'self'`).

**Что нужно сделать:**
1.  Настроить на бэкенде систему аутентификации по номеру телефона (например, через Firebase Authentication или другой SMS-сервис).
2.  На фронтенде (в `AppContext.tsx`) хранить токен пользователя и отправлять его с каждым запросом к API.
3.  Заменить все использования `MOCK_USER_ID` на реальный ID аутентифицированного пользователя.

### Шаг 2: База данных и API

Вам нужно создать базу данных (например, PostgreSQL, MongoDB, Firestore) и реализовать API для управления данными.

**Модели данных (схемы):**
Все необходимые типы уже описаны в `src/lib/types.ts`. Вам нужно создать соответствующие таблицы/коллекции в вашей БД для:
*   `User`
*   `Order` (заказы услуг)
*   `MarketplaceOrder` (заказы в маркете)
*   `Product`
*   `Shop`
*   `DriverProfile`
*   `SellerProfile`

**Примерный список API-эндпоинтов:**
*   `POST /api/auth/login` - Отправка кода верификации.
*   `POST /api/auth/verify` - Проверка кода и выдача токена.
*   `GET /api/profile` - Получение профиля текущего пользователя.
*   `GET /api/orders` - Получение списка заказов (услуг).
*   `POST /api/orders` - Создание нового заказа услуги.
*   `POST /api/orders/:id/accept` - Водитель принимает заказ.
*   `POST /api/orders/:id/complete` - Водитель завершает заказ.
*   `GET /api/marketplace/products` - Получение списка товаров.
*   `GET /api/marketplace/shops` - Получение списка магазинов.
*   `POST /api/marketplace/orders` - Создание заказа в маркетплейсе.
*   ... и так далее для всех CRUD-операций (создание, чтение, обновление, удаление).

**Интеграция:**
В `AppContext.tsx` замените вызовы `setOrders([...])`, `setProducts([...])` и т.д. на `fetch('/api/...')`.

### Шаг 3: Отслеживание водителя в реальном времени

Сейчас движение водителя симулируется на клиенте. Для реального отслеживания:

**Что нужно сделать:**
1.  **На бэкенде:** Поднять WebSocket-сервер (например, с помощью Socket.IO).
2.  **В приложении водителя:** Периодически (каждые 5-10 секунд) отправлять свои координаты (`navigator.geolocation`) на бэкенд через WebSocket.
3.  **На бэкенде:** При получении координат водителя, пересылать их соответствующему клиенту (заказчику) через его WebSocket-соединение.
4.  **В приложении клиента:** В компоненте `ActiveOrderCard` (`src/app/(app)/dashboard/page.tsx`) слушать WebSocket-события и обновлять позицию маркера водителя на карте.

### Шаг 4: Интеграция платежей (Кошелек)

Логика взаимодействия с платежной системой (например, YooMoney) должна быть **только на бэкенде** из соображений безопасности.

**Что нужно сделать:**
1.  **На бэкенде:** Реализовать API для:
    *   Создания ссылки на пополнение баланса.
    *   Обработки webhook'ов от платежной системы для подтверждения пополнения.
    *   Осуществления выплат на кошельки водителей/продавцов.
2.  **На фронтенде:** Кнопки "Пополнить" и "Вывести" в профилях (`src/app/(app)/driver/profile/page.tsx`, `src/app/(app)/profile/page.tsx`) должны вызывать эти API-эндпоинты.

---

Этот прототип — прочная основа для вашего проекта. Удачи в разработке бэкенда!
